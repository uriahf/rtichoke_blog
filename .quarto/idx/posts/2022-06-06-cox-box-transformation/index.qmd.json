{"title":"Box-Cox transformation from Feature Engineering by Max Kuhn and Kjell Johnson","markdown":{"yaml":{"title":"Box-Cox transformation from Feature Engineering by Max Kuhn and Kjell Johnson","date":"2012-06-06","categories":["Replications","ROC","Max Kuhn","Kjell Johnson","Feature Engineering by Max Kuhn and Kjell Johnson","caret"],"image":"image.png"},"headingText":"Welcome to rtichoke blog!","containsRefs":false,"markdown":"\n\n\nThis blog will be dedicated to the {rtichoke} package, which means that it will contain posts that are related to performance metrics and the possible related usability of {rtichoke}.\n\n## Replications\n\nTo make the package easier to use I plan to reproduce other people's code with rtichoke, posts of this kind will be available under the category \"replications\".\n\nMy first choice is to replicate the first example from the book [\"Feature Engineering and Selection: A Practical Approach for Predictive Models by Max Kuhn and Kjell Johnson\"](http://www.feat.engineering/a-simple-example.html).\n\nIn this example you can see how Box-Cox transformation improves the discrimination capability of the logistic regression model without using any additional information.\n\n## Original Code\n\nThe code is almost identical to the original code that can be found [on github](https://github.com/topepo/FES/blob/master/01_Introduction/1_01_A_Simple_Example.R).\n\n### Preparing the Data\n\n```{r}\n#| message: false\n#| warning: false\n#| include: false\n\nggplot2::theme_set(ggplot2::theme_classic())\nggplot2::theme_update(\n  rect = ggplot2::element_rect(fill = \"transparent\"),\n      panel.background = ggplot2::element_rect(fill='transparent'), #transparent panel bg\n    plot.background = ggplot2::element_rect(fill='transparent', color=NA), #transparent plot bg\n    panel.grid.major = ggplot2::element_blank(), #remove major gridlines\n    panel.grid.minor = ggplot2::element_blank(), #remove minor gridlines\n    legend.background = ggplot2::element_rect(fill='transparent'), #transparent legend bg\n    legend.box.background = ggplot2::element_rect(fill='transparent') #transparent legend panel\n)\n```\n\n```{r}\n#| message: false\n#| warning: false\n\nlibrary(caret)\nlibrary(tidymodels)\nlibrary(ggplot2)\n\n\ndata(segmentationData)\n\nsegmentationData <- \n  segmentationData %>% \n  dplyr::select(EqSphereAreaCh1, PerimCh1, Class, Case) %>% \n  setNames(c(\"PredictorA\", \"PredictorB\", \"Class\", \"Case\")) %>% \n  mutate(Class = factor(ifelse(Class == \"PS\", \"One\", \"Two\")))\n\nexample_train <- \n  segmentationData %>% \n  dplyr::filter(Case == \"Train\") %>% \n  dplyr::select(-Case)\n\nexample_test  <- \n  segmentationData %>% \n  dplyr::filter(Case == \"Test\") %>% \n  dplyr::select(-Case)\n```\n\n### Training the Models\n\n```{r}\n\nexample_ctrl <- \n  trainControl(method = \"none\",\n               classProbs = TRUE,\n               summaryFunction = twoClassSummary)\n\nnatural_terms <- train(Class ~ PredictorA + PredictorB,\n                       data = example_train,\n                       method = \"glm\",\n                       metric = \"ROC\",\n                       trControl = example_ctrl)\n\ntrans_terms <- train(Class ~ PredictorA + PredictorB,\n                     data = example_train,\n                     method = \"glm\",\n                     preProc = \"BoxCox\",\n                     metric = \"ROC\",\n                     trControl = example_ctrl)\n\n```\n\n### Creating Predictions\n\n```{r}\n\noriginal_probs <- predict(natural_terms, example_test, type = \"prob\")[,1]\n\ntransformed_probs <- predict(trans_terms, example_test, type = \"prob\")[,1]\n\noutcomes <- example_test$Class == \"One\"\n\n```\n\n### Creating ROC Curve with yardstick\n\n```{r}\n#| message: false\n#| warning: false\n#| eval: false\n\n\nnatural_dat <-\n  example_test %>% \n  mutate(\n    prob = original_probs) %>% \n  roc_curve(Class, prob) %>% \n  mutate(Format = \"Natural Units\")\n\ntrans_dat <-\n  example_test %>% \n  mutate(\n    prob = transformed_probs) %>% \n  roc_curve(Class, prob) %>% \n  mutate(Format = \"Inverse Units\") \n\nboth_dat <- \n  bind_rows(natural_dat, trans_dat) %>%\n  mutate(\n    Format = factor(Format, levels = c(\"Natural Units\", \"Inverse Units\")))\n\ntrans_roc_plot <- \n  ggplot(both_dat) +\n  geom_step(aes(x = 1 - specificity, y = sensitivity, color = Format)) + \n  coord_equal() + \n  xlab(\"False Positive Rate\") + \n  ylab(\"True Positive Rate\") + \n  theme(legend.position = c(.8, .2)) + \n  scale_colour_manual(\n    values = c(\"Natural Units\" = \"grey\", \n               \"Inverse Units\" = \"black\")) + \n  geom_abline(intercept = 0, slope = 1, col = \"grey\", lty = 2) +\n  theme_classic()\n\ntrans_roc_plot\n\n```\n\n![](trans_roc_plot.svg)\n\n```{r eval=FALSE, include=FALSE}\n#| include: false\n#| eval: false\n\n# ggsave(\"./content/blog/2022-06-06-cox-box-transformation/trans_roc_plot.svg\",    \n#        # plot = trans_roc_plot,\n#        bg='transparent', \n#        units = \"px\")\n\n```\n\n## rtichoke code\n\n### Creating ROC Curve with rtichoke\n\n::: panel-tabset\n## By Probability Threshold\n\n::: {layout-ncol=\"2\"}\n```{r}\n#| message: false\n#| warning: false\n#| eval: false\n\nlibrary(rtichoke)\n\ncreate_roc_curve(\n  probs = list(\n    \"Natural Units\" = original_probs,\n    \"Inverse Units\" = transformed_probs\n  ),\n  reals = list(\n    outcomes\n  ),\n  size = 350, \n  col_values = c(\"grey\", \"black\")\n) \n\n```\n\n```{r}\n#| message: false\n#| warning: false\n#| echo: false\n\nlibrary(rtichoke)\n\ncreate_roc_curve(\n  probs = list(\n    \"Natural Units\" = original_probs,\n    \"Inverse Units\" = transformed_probs\n  ),\n  reals = list(\n    outcomes\n  ),\n  size = 350, \n  col_values = c(\"grey\", \"black\")\n) %>% \nplotly::layout(plot_bgcolor = \"#fff7f5\", \n               paper_bgcolor= \"#fff7f5\")\n\n```\n:::\n\n## By Percent Positives Conditional Rate\n\n::: {layout-ncol=\"2\"}\n```{r}\n#| message: false\n#| warning: false\n#| eval: false\n\n\nlibrary(rtichoke)\n\ncreate_roc_curve(\n  probs = list(\n    \"Natural Units\" = original_probs,\n    \"Inverse Units\" = transformed_probs\n  ),\n  reals = list(\n    outcomes\n  ),\n  stratified_by = \"ppcr\",\n  size = 350, \n  col_values = c(\"grey\", \"black\")\n) \n\n```\n\n```{r}\n#| message: false\n#| warning: false\n#| echo: false\n\nlibrary(rtichoke)\n\ncreate_roc_curve(\n  probs = list(\n    \"Natural Units\" = original_probs,\n    \"Inverse Units\" = transformed_probs\n  ),\n  reals = list(\n    outcomes\n  ),\n  stratified_by = \"ppcr\",\n  size = 350, \n  col_values = c(\"grey\", \"black\")\n) %>% \nplotly::layout(plot_bgcolor = \"#fff7f5\", \n               paper_bgcolor= \"#fff7f5\")\n\n```\n:::\n:::\n"},"formats":{"html":{"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":true,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"knitr"},"render":{"keep-tex":false,"keep-yaml":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[]},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","output-file":"index.html"},"language":{},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.0.38","editor":"visual","theme":"../../theme.scss","title-block-banner":true,"comments":{"utterances":{"repo":"uriahf/blogComments"}},"title":"Box-Cox transformation from Feature Engineering by Max Kuhn and Kjell Johnson","date":"2012-06-06","categories":["Replications","ROC","Max Kuhn","Kjell Johnson","Feature Engineering by Max Kuhn and Kjell Johnson","caret"],"image":"image.png"},"extensions":{"book":{"multiFile":true}}}}}